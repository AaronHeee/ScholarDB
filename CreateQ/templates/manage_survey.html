<!DOCTYPE html>
<html>
<head>
	<title>调研回收</title>
    {% load staticfiles %}
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link href="{% static "css/bootstrap/bootstrap.css" %}" rel="stylesheet" />
    <link href="{% static "css/bootstrap/bootstrap-responsive.css" %}" rel="stylesheet" />
    <link href="{% static "css/bootstrap/bootstrap-overrides.css"%}" type="text/css" rel="stylesheet" />

    <!-- global styles -->
    <link rel="stylesheet" type="text/css" href="{% static "css/layout.css" %}" />
    <link rel="stylesheet" type="text/css" href="{% static "css/elements.css" %}" />
    <link rel="stylesheet" type="text/css" href="{% static  "css/icons.css"%}" />

    <!-- libraries -->

    <link rel="stylesheet" type="text/css" href="{% static "css/lib/font-awesome.css"%}" />
    <link href="{% static "css/lib/bootstrap-wysihtml5.css"%}" type="text/css" rel="stylesheet" />
    <link href="{% static "css/lib/uniform.default.css"%}" type="text/css" rel="stylesheet" />
    <link href="{% static "css/lib/select2.css"%}" type="text/css" rel="stylesheet" />
    <link href="{% static "css/lib/bootstrap.datepicker.css" %}" type="text/css" rel="stylesheet" />
    <link href="{% static "css/lib/font-awesome.css"%}" type="text/css" rel="stylesheet" />

    <!-- this page specific styles -->
    <link rel="stylesheet" href="{% static "css/compiled/form-showcase.css"%}" type="text/css" media="screen" />
    <link rel="stylesheet" href="{% static "css/compiled/form-wizard.css"%}" type="text/css" media="screen" />
    <link rel="stylesheet" href="{% static "css/compiled/user-list.css" %}" type="text/css" media="screen" />
    <link rel="stylesheet" href="{% static "css/compiled/index.css" %}" type="text/css" media="screen" />

    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /></head>
<body>
{% include "common_nav_bar.html" %}
{% include "common_side_bar.html" %}

<div style = "display: none">
    {% include "elements.html" %}
</div>
    <div id="myModal" class="modal hide" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
          <h5 id="myModalLabel">编辑调研合作者<small>#{{ sno }}</small></h5>
      </div>
      <div class="modal-body align-center">
            <input type="text" class="input-medium search-query center">
            <button class="btn">添加</button>
            <ul id="scholar-search-result">
            </ul>
      </div>
      <div class="modal-footer">
        <button class="btn" data-dismiss="modal" aria-hidden="true">关闭</button>
        <button class="btn btn-primary">保存</button>
      </div>
    </div>
	<!-- main container -->
    <div class="content">
        <div class="container-fluid">
            <div id="pad-wrapper">
                <!-- users table -->
                    <div class="row-fluid header">
                        <div class="span3">
                            <h2>调研管理后台<small>#{{ sno }}</small></h2>
                        </div>
                    </div>
                    <div class="row-fluid filter-block">
                        <div id="main-stats">
                            <div class="row-fluid stats-row">
                                <div class="span4 stat">
                                    <div class="data">
                                        <i class="icon-cloud-download icon-2x">&nbsp;&nbsp;</i>
                                        <span class="number" id="answer-cnt"></span>
                                        回收问卷
                                    </div>
                                </div>
                                <div class="span4 stat">
                                    <div class="data">
                                        <i class="icon-group icon-2x">&nbsp;&nbsp;</i>
                                        <span class="number" id="contributor-cnt"></span>
                                        合作学者
                                        <a href="#myModal" data-toggle="modal">编辑</a>
                                    </div>
                                </div>
                                <div class="span4 stat">
                                    <div class="data">
                                        <i class="icon-tag icon-2x">&nbsp;&nbsp;</i>
                                        <span class="number" id="stage"></span>
                                        项目状态
                                        <a href="#myModal" data-toggle="modal">编辑</a>
                                    </div>

                                </div>
                            </div>
                        </div>
                        <hr/>
                        <div class="tabbable" id="tabs-679254">
                            <ul class="nav nav-tabs">
                                <li class = "active">
                                     <a href="#panel-1" data-toggle="tab">筛选</a>
                                </li>
                                <li>
                                     <a href="#panel-2" data-toggle="tab">统计</a>
                                </li>
                            </ul>
                            <div class="tab-content">
                                <div class="tab-pane active" id="panel-1">
                                    <div class = "accordion" id = "accordion2">

                                    </div>
                                </div>
                                <div class="tab-pane" id="panel-2">
                                    <p>
                                        第二部分内容.
                                    </p>
                                </div>
                            </div>

                        </div>


                </div>
            </div>
        </div>
    </div>
    <!-- end main container -->


	<!-- scripts -->
    <script src="{% static "js/jquery-latest.js" %}"></script>
    <script src="{% static "js/bootstrap.js"%}"></script>
    <script src="{% static "js/theme.js"%}"></script>
    <script src="{% static "js/jquery.uniform.min.js"%}"></script>
    <script src="{% static "js/select2.min.js"%}"></script>
    <script>
        var sno = {{ sno }};
        load_contributor();
        load_by_user();
        load_summary();
        function load_contributor(){
            $.getJSON("{% url "manage" %}",{"load_contributor":"true","sno":sno},function(res){
                document.getElementById("contributor-cnt").innerHTML = res.contributor_cnt;
            })
        }
        function load_by_user() {
            $.getJSON("{% url "manage" %}",{"load_by_user":"true","sno":sno},function(res){
              //document.write(JSON.stringify(res));
              answer_group_by_user("accordion2",sno,res);
            })
        }
        function load_summary() {
            $.getJSON("{% url "manage" %}",{"load_summary":"true","sno":sno},function(res){
              //document.write(JSON.stringify(res));
              document.getElementById("answer-cnt").innerHTML = res.answer_cnt;
              document.getElementById("stage").innerHTML = res.stage;
            })
        }
        function search_user(name){
            $.getJSON("{% url "manage" %}",{"search_user":"true","sno":sno,"name":name},function(res){
              var ul = document.getElementById("scholar-search-result");
              ul.innerHTML = "";
              for(var item in res) {
                  var ele = document.createElement('a');
                  ele.innerHTML = name+" "+res.inst;
                  ul.onclick = add_contributor(name);
                  ul.appendChild(ele);
              }
            })
        }
        function add_contributor(name){
            $.getJSON("{% url "manage" %}",{"add_contributor":"true","sno":sno,"name":name});
            alert("添加成功");
        }

    </script>
    <script type="text/javascript">
        $(function () {

            // add uniform plugin styles to html elements
            $("input:checkbox, input:radio").uniform();

            // select2 plugin for select elements
            $(".select2").select2({
                placeholder: "请选择..."
            });

            // wysihtml5 plugin on textarea
            $(".wysihtml5").wysihtml5({
                "font-styles": false
            });
        });
    </script>
</body>
</html>